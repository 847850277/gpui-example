# Step-1-MySQL 连接面板实现指南

概述
本指南详细说明了如何实现 RuSQL 应用程序的 MySQL 连接面板。连接面板是用户与应用程序交互的第一个界面，用于建立与 MySQL 数据库的连接。


## 视觉参考

参考 Adminer 的连接界面。需要复制的关键元素：

- 简洁、专注的表单布局
- 清晰标记的输入字段
- 服务器类型选择（虽然我们只实现 MySQL）
- 直观的连接按钮
- 连接状态的视觉反馈


## 组件需求

实现具有以下元素和功能的连接面板组件：

- 1、服务器类型选择器
  - 固定下拉菜单仅显示"MySQL"
  - 设计应支持未来添加其他数据库类型
- 2、连接表单
  - 服务器输入字段，带主机名/IP验证（默认：localhost）
  - 端口字段，带数字验证（默认：3306）
  - 用户名字段（默认："root"）
  - 密码字段，带安全输入遮罩
  - 可选的数据库名称字段
  - 连接名称字段（用于保存连接）
- 3、已保存的连接
  - 显示先前保存的连接的下拉列表
  - 选择、编辑或删除已保存连接的选项
- 4、连接控制
  - 主要"连接"按钮，带加载状态
  - 次要"清除"按钮，重置表单
  - 视觉连接状态指示器
- 5、状态反馈
  - 成功/错误消息区域
  - 连接尝试进度指示器
  - 连接失败时的清晰错误消息


## 数据模型

定义以下数据结构：

/// MySQL数据库的连接设置
struct ConnectionSettings {
    /// 已保存连接的连接名称
    name: Option<String>,
    /// 数据库服务器主机（IP或主机名）
    host: String,
    /// 数据库服务器端口
    port: u16,
    /// 用于认证的用户名
    username: String,
    /// 用于认证的密码
    password: String,
    /// 要连接的可选数据库名称
    database: Option<String>,
    /// 连接超时（秒）
    timeout: u16,
}


/// 连接状态指示
enum ConnectionStatus {
    Disconnected,   // 已断开
    Connecting,     // 连接中
    Connected,      // 已连接
    Failed(String), // 失败（包含错误消息）
}

/// 已保存连接的集合
struct SavedConnections {
    connections: Vec<SavedConnection>,
}

/// 单个已保存的连接配置
struct SavedConnection {
    id: String,
    name: String,
    settings: ConnectionSettings,
}


## 组件架构

组件结构：

- 1、视图结构
  - ConnectionPanelView 作为主视图
  - 表单部分和控件的子组件
  - 状态显示组件
- 2、状态管理
  - 使用 GPUI 的 Model 来管理连接设置
  - 实现连接状态的适当状态转换
  - 持久存储已保存的连接
- 3、事件处理
  - 表单字段变更处理程序
  - 连接按钮点击处理程序
  - 已保存连接选择处理程序


## 样式指南

实现视觉设计，应：

- 使用简洁、专业的配色方案
- 提供清晰的视觉层次结构
- 突出显示活动/焦点元素
- 内联显示验证错误
- 为状态变化提供微妙的动画
- 保持一致的内边距和间距

## 实现方法

- 第一阶段：基础表单
  - 实现表单字段和布局
  - 添加基本验证
  - 根据指南设计表单样式
- 第二阶段：连接逻辑
  - 实现连接尝试功能
  - 添加加载状态和错误处理
  - 显示连接状态反馈
- 第三阶段：连接管理
  - 添加连接配置的保存/加载
  - 实现已保存连接的下拉菜单
  - 添加已保存连接的编辑和删除功能
- 第四阶段：高级选项
  - 实现高级选项部分
  - 添加超时设置

## 测试场景

包括以下测试：

- 表单验证（必填字段、格式验证）
- 连接状态转换
- 各种失败场景的错误消息显示
- 保存和加载连接配置
- 连接尝试期间的UI响应性

## 集成点

该组件应：

- 在连接成功时发出事件
- 向父组件提供已建立的数据库连接
- 允许父组件以编程方式断开连接
- 启用在不同已保存连接之间切换


## 用户故事示例

1、作为用户，我希望通过输入服务器详细信息连接到本地MySQL数据库
2、作为用户，我希望保存我的连接设置以备将来使用
3、作为用户，当连接失败时，我希望得到明确的反馈和具体的错误消息
4、作为用户，我希望能够快速从之前保存的连接中进行选择

## 代码结构

src/
  ui/
    connection_panel/
      mod.rs                 # 模块导出
      connection_panel.rs    # 主面板组件
      connection_form.rs     # 表单输入组件
      saved_connections.rs   # 已保存连接下拉菜单
      connection_status.rs   # 状态显示组件
  models/
    connection.rs            # 连接数据模型
  services/
    database_service.rs      # 数据库连接服务

